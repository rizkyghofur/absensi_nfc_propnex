<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; connect-src 'self' https://newapi.propnex.id; img-src 'self' data: https://newapi.propnex.id; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;"
    />
    <title>PropNex NFC Attendance System</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Titlebar drag region -->
    <div class="titlebar">
      <div class="titlebar-text">PropNex NFC Attendance System</div>
    </div>

    <div class="app-container">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <div class="logo-icon">
            <img
              src="assets/icon.png"
              alt="PropNex Logo"
              style="
                width: 40px;
                height: 40px;
                border-radius: 8px;
                object-fit: contain;
              "
            />
          </div>
          <div class="logo-text">
            <h1>PropNex NFC</h1>
            <span class="subtitle">Attendance System</span>
          </div>
        </div>
        <div class="reader-status" id="readerStatus">
          <div class="status-dot disconnected" id="statusDot"></div>
          <span id="statusText">Menunggu Reader...</span>
        </div>
      </header>

      <!-- Navigation Tabs -->
      <nav class="nav-tabs">
        <button class="nav-tab active" data-target="cekKartuView">
          <span class="tab-icon">üîç</span>
          Cek Kartu NFC
        </button>
        <button class="nav-tab" data-target="presensiView">
          <span class="tab-icon">üìÖ</span>
          Presensi Kartu NFC
        </button>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <!-- VIEWS WRAPPER -->
        <div class="views-wrapper" id="viewsWrapper">
          
          <!-- VIEW 1: CEK KARTU NFC (Default) -->
          <div class="view-container active" id="cekKartuView">
            <!-- NFC Scan Area -->
            <div class="scan-section">
          <div class="scan-card" id="scanCard">
            <div class="scan-rings" id="scanRings">
              <div class="ring ring-1"></div>
              <div class="ring ring-2"></div>
              <div class="ring ring-3"></div>
            </div>
            <div class="scan-icon" id="scanIcon">
              <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                <path
                  d="M12 32C12 20.954 20.954 12 32 12C43.046 12 52 20.954 52 32"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                  opacity="0.3"
                />
                <path
                  d="M18 32C18 24.268 24.268 18 32 18C39.732 18 46 24.268 46 32"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                  opacity="0.5"
                />
                <path
                  d="M24 32C24 27.582 27.582 24 32 24C36.418 24 40 27.582 40 32"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                  opacity="0.7"
                />
                <circle cx="32" cy="32" r="4" fill="currentColor" />
                <path
                  d="M32 36V52"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                />
              </svg>
            </div>
            <div class="scan-text" id="scanText">
              <h2>Tempelkan Kartu NFC</h2>
              <p>Dekatkan kartu ke reader ACR122U</p>
            </div>
          </div>

          <!-- Card Info Display -->
          <div class="card-info hidden" id="cardInfo">
            <!-- NDEF Records -->
            <div class="ndef-records hidden" id="ndefRecords">
              <!-- vCard Display -->
              <div class="vcard-display hidden" id="vcardDisplay">
                <div class="vcard-header">
                  <div class="vcard-avatar" id="vcardAvatar">?</div>
                  <div class="vcard-name-info">
                    <h4 id="vcardName">-</h4>
                    <span class="vcard-org" id="vcardOrg">-</span>
                  </div>
                </div>
                <div class="vcard-fields">
                  <div class="vcard-field hidden" id="vcardPhoneRow">
                    <span class="vcard-field-icon">üì±</span>
                    <div class="vcard-field-content">
                      <label>Telepon</label>
                      <span id="vcardPhone">-</span>
                    </div>
                  </div>
                  <div class="vcard-field hidden" id="vcardEmailRow">
                    <span class="vcard-field-icon">‚úâÔ∏è</span>
                    <div class="vcard-field-content">
                      <label>Email</label>
                      <span id="vcardEmail">-</span>
                    </div>
                  </div>
                  <div class="vcard-field hidden" id="vcardUrlRow">
                    <span class="vcard-field-icon">üîó</span>
                    <div class="vcard-field-content">
                      <label>Link vCard</label>
                      <span id="vcardUrl">-</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- URI Record Display -->
              <div class="uri-display hidden" id="uriDisplay">
                <div
                  class="uri-row"
                  style="padding: 12px; margin-bottom: 8px; margin-top: 8px"
                >
                  <span class="uri-icon">üåê</span>
                  <div class="uri-content">
                    <label>Website</label>
                    <span id="uriValue" class="info-value">-</span>
                  </div>
                </div>
              </div>

              <!-- Text Record Display (Agent Info) -->
              <div class="text-display hidden" id="textDisplay">
                <div
                  class="text-row-group"
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 10px;
                  "
                >
                  <div class="text-row">
                    <span class="text-icon">üíº</span>
                    <div class="text-content">
                      <label>Agent ID</label>
                      <span id="agentIdValue" class="info-value">-</span>
                    </div>
                  </div>
                  <div class="text-row">
                    <span class="text-icon">üè¢</span>
                    <div class="text-content">
                      <label>Branch Code</label>
                      <span id="branchCodeValue" class="info-value">-</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Raw/Unknown Record Display -->
              <div class="raw-display hidden" id="rawDisplay">
                <div class="text-row">
                  <span class="text-icon">üìÑ</span>
                  <div class="text-content">
                    <label>Raw Data</label>
                    <span id="rawValue" class="info-value">-</span>
                  </div>
                </div>
              </div>
              </div>
            </div> <!-- closes ndefRecords -->
          </div> <!-- closes cardInfo -->
        </div> <!-- closes scan-section -->
      </div> <!-- closes cekKartuView -->

        <!-- VIEW 2: PRESENSI KARTU NFC -->
        <div class="view-container" id="presensiView">
          <div class="presensi-section">
            <div class="header-action presensi-header">
              <h2>Mode Presensi</h2>
              <div class="event-selector">
                <label for="eventSelect">Pilih Event:</label>
                <select id="eventSelect" class="presensi-select">
                  <option value="">Memuat event...</option>
                </select>
                <button id="btnRefreshEvents" class="btn-clear refresh-btn" title="Refresh Event">‚Üª</button>
              </div>
            </div>

            <div class="scan-card" id="presensiScanCard">
              <div class="scan-rings" id="presensiScanRings">
                <div class="ring ring-1"></div>
                <div class="ring ring-2"></div>
                <div class="ring ring-3"></div>
              </div>
              <div class="scan-icon" id="presensiScanIcon">
                <!-- Reuse NFC icon SVG -->
                <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                  <path d="M12 32C12 20.954 20.954 12 32 12C43.046 12 52 20.954 52 32" stroke="currentColor" stroke-width="3" stroke-linecap="round" opacity="0.3"/>
                  <path d="M18 32C18 24.268 24.268 18 32 18C39.732 18 46 24.268 46 32" stroke="currentColor" stroke-width="3" stroke-linecap="round" opacity="0.5"/>
                  <path d="M24 32C24 27.582 27.582 24 32 24C36.418 24 40 27.582 40 32" stroke="currentColor" stroke-width="3" stroke-linecap="round" opacity="0.7"/>
                  <circle cx="32" cy="32" r="4" fill="currentColor" />
                  <path d="M32 36V52" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="scan-text" id="presensiScanText">
                <h2>Siap Membaca</h2>
                <p>Tempelkan kartu peserta ke reader</p>
              </div>
            </div>

            <!-- Presensi Result Display -->
            <div class="card-info hidden" id="presensiResultInfo">
              <div class="presensi-status-box" id="presensiStatusBox">
                <!-- Status will be injected here (Success/Error) -->
              </div>
              
              <div class="card-info-grid">
                <div class="info-item">
                  <label>Agent Name</label>
                  <span id="presensiAgentName" class="info-value">-</span>
                </div>
                <div class="info-item">
                  <label>Waktu Presensi</label>
                  <span id="presensiTime" class="info-value">-</span>
                </div>
              </div>
              
              <div class="text-row-group presensi-grid-bottom">
                <div class="info-item">
                  <label>Agent ID</label>
                  <span id="presensiAgentId" class="info-value">-</span>
                </div>
                <div class="info-item">
                  <label>Branch Code</label>
                  <span id="presensiBranchCode" class="info-value">-</span>
                </div>
              </div>
            </div>

            <!-- Presence List -->
            <div class="presence-list-container">
              <div class="presence-list-header">
                <div class="header-main">
                  <h3>Status Kehadiran</h3>
                  <span id="presenceCount" class="presence-badge">0 Peserta</span>
                </div>
                <div class="presence-search">
                  <span class="search-icon">üîç</span>
                  <input type="text" id="agentSearchInput" placeholder="Cari nama agen..." autocomplete="off">
                </div>
              </div>
              <div class="presence-list" id="presenceList">
                <div class="presence-empty" id="presenceEmpty">
                  Pilih event untuk melihat daftar kehadiran
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

        <!-- Scan History -->
        <div class="history-section">
          <div class="history-header">
            <h3>
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10" />
                <polyline points="12,6 12,12 16,14" />
              </svg>
              Riwayat Scan
            </h3>
            <button class="btn-clear" id="btnClear" title="Bersihkan riwayat">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="3,6 5,6 21,6" />
                <path
                  d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"
                />
              </svg>
              Hapus
            </button>
          </div>
          <div class="history-list" id="historyList">
            <div class="history-empty" id="historyEmpty">
              <svg
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1"
                opacity="0.3"
              >
                <rect x="2" y="3" width="20" height="18" rx="2" />
                <path d="M8 7h8M8 11h5" />
              </svg>
              <p>Belum ada kartu yang di-scan</p>
            </div>
          </div>
        </div>
      </main>

      <!-- Error Toast -->
      <div class="toast hidden" id="errorToast">
        <div class="toast-icon">‚ö†Ô∏è</div>
        <span id="errorText">Error message</span>
      </div>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
